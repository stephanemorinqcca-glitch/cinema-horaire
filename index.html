<!DOCTYPE html>

<html lang="fr">
	<head>
		<meta charset="utf-8" />
		<meta content="width=1200" name="viewport" />
		<link
			rel="shortcut icon"
			href="data:image/x-icon;base64,AAABAAEAEBAAAAAAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAQAQAAAAAAAAAAAAAAAAAAAAAAAD///8B////Af///wH///8B////ASOvai8jr2p/I69qnyOvap8jr2p/I69qL////wH///8B////Af///wH///8B////Af///wH///8BI69qPyOvat8jr2r/I69q/yOvav8jr2r/I69q/yOvav8jr2rfI69qP////wH///8B////Af///wH///8BI69qXyOvav8jr2r/I69q/yOvav8jr2r/I69q/yOvav8jr2r/I69q/yOvav8jr2pf////Af///wH///8BI69qPyOvav8jr2r/I69q/yOvav9MvoX/kde0/5HXtP8wtHP/I69q/yOvav8jr2r/I69q/yOvaj////8B////ASOvat8jr2r/I69q/yOvav8jr2r/rOHH////////////dc2h/yOvav8jr2r/I69q/yOvav8jr2rf////ASOvai8jr2r/I69q/yOvav8jr2r/I69q//H69f///////////9Xw4/8jr2r/I69q/yOvav8jr2r/I69q/yOvai8jr2p/I69q/yOvav8jr2r/I69q/2fImP//////////////////////Prl8/yOvav8jr2r/I69q/yOvav8jr2p/I69qnyOvav8jr2r/I69q/yOvav+s4cf//////+P17P///////////4PSq/8jr2r/I69q/yOvav8jr2r/I69qnyOvap8jr2r/I69q/yOvav8jr2r/8fr1//////+e3L3/uubQ///////V8OP/I69q/yOvav8jr2r/I69q/yOvap8jr2p/I69q/yOvav8jr2r/Z8iY////////////Z8iY/3XNof///////////z65fP8jr2r/I69q/yOvav8jr2p/I69qLyOvav8jr2r/I69q/6zhx///////8fr1/yOvav8wtHP///////////+D0qv/I69q/yOvav8jr2r/I69qL////wEjr2rfI69q/yOvav/x+vX//////7rm0P8jr2r/I69q/7rm0P//////1fDj/yOvav8jr2r/I69q3////wH///8BI69qPyOvav8jr2r/g9Kr/5HXtP9MvoX/I69q/yOvav9MvoX/kde0/2fImP8jr2r/I69q/yOvaj////8B////Af///wEjr2pfI69q/yOvav8jr2r/I69q/yOvav8jr2r/I69q/yOvav8jr2r/I69q/yOval////8B////Af///wH///8B////ASOvaj8jr2rfI69q/yOvav8jr2r/I69q/yOvav8jr2r/I69q3yOvaj////8B////Af///wH///8B////Af///wH///8B////ASOvai8jr2p/I69qnyOvap8jr2p/I69qL////wH///8B////Af///wH///8BAAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//w=="
			type="image/x-icon"
		/>
		<title>Horaire des films au Cinéma centre-ville | St-Georges</title>
		<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet" />
		<link rel="stylesheet" href="style.css" />
	</head>
	<body>
		<header>
			<a href="https://www.cine-flash.com/">
				<img id="banner" alt="Cinéma centre-ville Laser par BARCO" src="https://veeziustaskscm.blob.core.windows.net/veezi-ticketing-assets/jjwk2hm92x8zmdt4ys4sr1vvp0/banner?202508291726" />
			</a>
		</header>
		<main>
			<div id="legende"></div>
			<div id="films"></div>
		</main>
		<script>
		// ✅ Définition unique des mots-clés
		const motsCles = [
    		"Déconseillé aux jeunes enfants",
    		"Erostisme",
    		"Exempte de classement",
    		"Violence",
    		"Horreur",
    		"Langage Vulgaire",
    		"Pour Enfants",
    		"Sexualité Explicite"
		];

		// ✅ Nettoyage du contenu
		function cleanFilmContent(film) {
    		let contentOriginal = film.content || "";
    		let contentRestant = contentOriginal;

    		// Supprimer les mots-clés du contenu restant
    		motsCles.forEach(mot => {
        		const regex = new RegExp(`\\s*\\|?\\s*${mot}\\s*\\|?\\s*`, "gi");
        		contentRestant = contentRestant.replace(regex, " ");
    		});

    		// Nettoyer les séparateurs et espaces
    		contentRestant = contentRestant
        		.replace(/\s*\|\s*/g, " | ")
        		.replace(/\s{2,}/g, " ")
        		.trim();

    		// Formatage de la durée
    		let dureeFormatee = "";
    		if (film.duree && !isNaN(film.duree)) {
        		const heures = Math.floor(film.duree / 60);
        		const minutes = film.duree % 60;
        		dureeFormatee = `Durée ${heures}h${minutes.toString().padStart(2, "0")}`;
    		}		

   			const parts = [];
    		if (film.classification) parts.push(film.classification);
    		if (dureeFormatee) parts.push(dureeFormatee);
    		if (contentRestant) parts.push(contentRestant);

    		return parts.join(" | ");
			}

			// ✅ Génération du nom de fichier image
			function generateImageFilename(film) {
    			function normalizeText(text) {
        			return text
            			.normalize("NFD")
            			.replace(/[\u0300-\u036f]/g, "")
            			.replace(/\s+/g, "")
            		.replace(/[^a-zA-Z0-9+]/g, "");
    		}

    		let base = normalizeText(film.classification || "");

    		if (film.content) {
        		motsCles.forEach(mot => {
            		if (film.content.includes(mot)) {
                		base += normalizeText(mot);
            		}
        		});
    		}

    		return base + "RGB.jpg";
		}

		// ✅ Chargement des données
		fetch("films.json")
    		.then((response) => response.json())
    		.then((data) => {
        		const legendContainer = document.getElementById("legende");
        		data.legende.forEach((attr) => {
            		const wrapper = document.createElement("span");

            		const badge = document.createElement("span");
            		badge.className = "badge";
            		badge.textContent = attr.ShortName;

            		const description = document.createElement("span");
            		description.textContent = attr.Description;

            		wrapper.appendChild(badge);
            		wrapper.appendChild(description);
            		legendContainer.appendChild(wrapper);
        		});

        	const container = document.getElementById("films");
        	data.films.forEach((film) => {
            	const card = document.createElement("div");
            	card.className = "card";

            	const poster = document.createElement("div");
            	poster.className = "poster";
            	if (film.thumbnail) {
                	const img = document.createElement("img");
                	img.src = film.thumbnail;
                	img.alt = `Affiche de ${film.titre}`;
                	poster.appendChild(img);
            	}
            	card.appendChild(poster);

            	const details = document.createElement("div");
            	const title = document.createElement("h1");
            	title.textContent = film.titre;
            	details.appendChild(title);

            	if (film.classification || film.content) {
                	const contentBlock = document.createElement("div");

                	const cleanedContent = cleanFilmContent(film);

                	const content = document.createElement("span");
                	content.className = "content";
                	content.textContent = cleanedContent;
                	contentBlock.appendChild(content);

                	const imageFilename = generateImageFilename(film);
                	const image = document.createElement("img");
                	image.src = `classification/${imageFilename}`;
                	image.alt = "Classification visuelle";
                	image.className = "classification-image";

                	poster.appendChild(image);
                	details.appendChild(contentBlock);
           		 }

            	if (film.synopsis) {
                	const synopsis = document.createElement("div");
                	synopsis.className = "synopsis";
                	synopsis.textContent = film.synopsis;
                	details.appendChild(synopsis);
            	}

            	card.appendChild(details);
            	container.appendChild(card);
        	});
		});
			
			const seancesDiv = document.createElement("div");
			seancesDiv.className = "seances";

			// Grouper les séances par date
			const seancesParDate = {};

			film.horaire
				.sort((a, b) => (a.horaire < b.horaire ? -1 : 1))
				.forEach((seance) => {
					const parts = seance.horaire.trim().split(" ");
					const dateStr = parts[0]; // format YYYY-MM-DD
					const heure = parts[1];
					const attributs = parts
						.slice(2)
						.filter((item) => item.length > 0)
								.sort((a, b) => (a < b ? -1 : 1));

					if (!seancesParDate[dateStr]) {
							seancesParDate[dateStr] = [];
					}

					seancesParDate[dateStr].push({
						heure,
						attributs,
					});
				});

						// Afficher les séances regroupées
						Object.entries(seancesParDate).forEach(([dateStr, seances]) => {
							const dateObj = new Date(dateStr + "T00:00:00");
							const optionsJour = { weekday: "long" };
							const optionsJourNum = { day: "numeric" };
							const optionsMois = { month: "long" };

							const jour = dateObj.toLocaleDateString("fr-CA", optionsJour);
							const jourNum = dateObj.toLocaleDateString("fr-CA", optionsJourNum);
							const mois = dateObj.toLocaleDateString("fr-CA", optionsMois);

							const jourLabel = document.createElement("div");
							jourLabel.className = "jour-label";
							jourLabel.textContent = `${jour.toLowerCase()} ${jourNum}, ${mois.toLowerCase()}`;

							const horairesDiv = document.createElement("div");
							horairesDiv.className = "horaires";

							seances.forEach(({ heure, attributs }) => {
								const seanceLabel = document.createElement("div");

								const horaireLabel = document.createElement("span");
								horaireLabel.className = "seance-label";
								horaireLabel.textContent = heure;
								seanceLabel.appendChild(horaireLabel);

								if (attributs.length > 0) {
									const attributsLabel = document.createElement("span");
									attributsLabel.className = "attributs-label";
									attributsLabel.textContent = attributs.join("   ").trim();
									seanceLabel.appendChild(attributsLabel);
								}

								horairesDiv.appendChild(seanceLabel);
							});

							const jourBlock = document.createElement("div");
							jourBlock.className = "jour-block";
							jourBlock.appendChild(jourLabel);
							jourBlock.appendChild(horairesDiv);

							seancesDiv.appendChild(jourBlock);
						});

						details.appendChild(seancesDiv);

						card.appendChild(details);
						container.appendChild(card);
					});
				})
				.catch((error) => {
					console.error("Erreur lors du chargement du fichier films.json :", error);
				});
		</script>
	</body>
</html>




























