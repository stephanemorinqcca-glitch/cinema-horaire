<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=1200" name="viewport"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="data:image/png;base64,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" rel="shortcut icon" type="image/x-icon"/>
<!-- Favicon standard pour navigateurs -->
<link href="favicons/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="favicons/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
<!-- Icône pour iOS / iPadOS -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<!-- Icônes Android / Chrome -->
<link href="favicons/android-chrome-192x192.png" rel="icon" sizes="192x192" type="image/png"/>
<link href="favicons/android-chrome-512x512.png" rel="icon" sizes="512x512" type="image/png"/>
<!-- Safari Pinned Tab (optionnel, nécessite un SVG) -->
<link color="#5bbad5" href="favicons/safari-pinned-tab.svg" rel="mask-icon"/>
<!-- Manifest PWA -->
<link rel="manifest" href="favicons/site.webmanifest.json">
<!-- Couleurs pour l'intégration mobile -->
<meta content="#000000" name="theme-color"/>
<meta content="#ffffff" name="background-color"/>
<title>Horaire des films au Cinéma centre-ville | St-Georges</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&amp;display=swap" rel="stylesheet">
<link href="style.css" rel="stylesheet">
</link></link></head>
<body>
<header>
<a href="https://www.cine-flash.com/">
<img alt="Cinéma centre-ville Laser par BARCO" id="banner" src="https://veeziustaskscm.blob.core.windows.net/veezi-ticketing-assets/jjwk2hm92x8zmdt4ys4sr1vvp0/banner?202508291726"/>
</a>
</header>
<main>
<div id="legende"></div>
<p class="textlegende">Vente de billets sur place seulement, pour la séance en cours, aux personnes présentes</p>
<div id="films"></div>
<div class="modal" id="videoModal" style="display:none;">
	<div class="modal-content">
	<span class="close" id="closeModal">×</span>
	<div class="video-wrapper">
		<iframe allow="autoplay; encrypted-media" allowfullscreen="" frameborder="0" id="trailerFrame"></iframe>
		</div>
	</div>
</div>
</main>
<script>
			// ✅ Définition unique des mots-clés
			const motsCles = ["Déconseillé aux jeunes enfants", "Erostisme", "Exempte de classement", "Violence", "Horreur", "Langage Vulgaire", "Pour Enfants", "Sexualité Explicite"];
			const ratingDescriptions = {
				"13+": "12 ans - | DOIT ÊTRE ACCOMPAGNÉ PAR UN ADULTE",
				"16+": "Le film peut être vu uniquement par des personnes de 16 ans ou plus",
				"18+": "Le film peut être vu uniquement par des personnes de 18 ans ou plus",
				"Pour Enfants": "Le film convient aux jeunes enfants, particulièrement à ceux d’âge préscolaire.",
				"Déconseillé aux jeunes enfants": "Le film peut être vu par des personnes de tout âge.\n  Des passages peuvent perturber les enfants de moins de 8 ans.",
			};
	
			// ✅ Nettoyage du contenu
			function cleanFilmContent(film) {
				if (film.content === undefined) return "";

				let contentArray = film.content
					.split("|")
					.map((champ) => champ.trim())
					.filter((champ) => champ !== "" && !motsCles.includes(champ));

				// Formatage de la durée
				if (film.duree && !isNaN(film.duree)) {
					const heures = Math.floor(film.duree / 60);
					const minutes = film.duree % 60;
					contentArray.splice(0, 0, `Durée ${heures}h${minutes.toString().padStart(2, "0")}`);
				}

				return contentArray.join(" | ");
			}

			// ✅ Génération du nom de fichier image
			function generateImageFilename(film) {
				function normalizeText(text) {
					return text
						.normalize("NFD")
						.replace(/[\u0300-\u036f]/g, "")
						.replace(/\s+/g, "")
						.replace(/[^a-zA-Z0-9+]/g, "");
				}

				let base = normalizeText(film.classification || "");

				if (film.content) {
					motsCles.forEach((mot) => {
						if (film.content.includes(mot)) {
							base += normalizeText(mot);
						}
					});
				}

				return base + "RGB.jpg";
			}

			// ✅ Chargement des données
			fetch("films.json", { cache: "no-store" })
				.then((response) => response.json())
				.then((data) => {
					const legendContainer = document.getElementById("legende");
					data.legende.forEach((attr) => {
						const wrapper = document.createElement("span");

						const badge = document.createElement("span");
						badge.className = "badge";
						badge.textContent = attr.ShortName;

						const description = document.createElement("span");
						description.textContent = attr.Description;

						wrapper.appendChild(badge);
						wrapper.appendChild(description);
						legendContainer.appendChild(wrapper);
					});

					const container = document.getElementById("films");
					data.films.forEach((film) => {
						const nowTimestamp = Date.now() / 1000; // secondes UTC
  						if (film.last_show === null || nowTimestamp > film.last_show) {
    						return; // Film expiré, on ne l'affiche pas
  						}
						
						const card = document.createElement("div");
						card.className = "card";

						const poster = document.createElement("div");
						poster.className = "poster";

						// Utilise film.thumbnail si disponible
						if (film.thumbnail) {
  							const img = document.createElement("img");
  							img.src = film.thumbnail;
  							img.alt = `Affiche de ${film.titre}`;
  							img.style.cursor = "pointer";

  						// Vérifie si bande_annonce est définie et non vide
						if (film.bande_annonce && film.bande_annonce.trim() !== "") {
  							const url = film.bande_annonce.trim();

  							img.addEventListener("click", () => {
	    						let videoId = null;
  								let embedUrl = null;

    							try {
        							const urlObj = new URL(url);

									if (urlObj.hostname.includes("youtube.com") && urlObj.searchParams.get("v")) {
    									videoId = urlObj.searchParams.get("v");
    									embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1`;
									} else if (urlObj.hostname.includes("youtu.be")) {
    									videoId = urlObj.pathname.slice(1);
    									embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1`;
									} else if (urlObj.hostname.includes("vimeo.com")) {
    									videoId = urlObj.pathname.split("/").pop();
    									embedUrl = `https://player.vimeo.com/video/${videoId}?autoplay=1&muted=1`;
									}

    							} catch (e) {
        							console.error("URL invalide :", url);
    							}

    							if (embedUrl) {
        							const trailerFrame = document.getElementById("trailerFrame");
        							trailerFrame.src = embedUrl;
        							document.getElementById("videoModal").style.display = "flex";
    							} else {
        							window.open(url, "_blank");
    							}
							});

						}
				
  						poster.appendChild(img);
						}			

						card.appendChild(poster);

						const details = document.createElement("div");
						const title = document.createElement("h1");
						title.textContent = film.titre;
						details.appendChild(title);

						let classificationDetails = "";
						
						if (film.classification || film.content) {
							const contentBlock = document.createElement("div");

							let cleanedContent = cleanFilmContent(film);

							if (film.classification) {
								const rating = document.createElement("span");
								rating.className = "rating";
								rating.textContent = film.classification;
								contentBlock.appendChild(rating);

								cleanedContent = ` | ${cleanedContent}`;
								if (ratingDescriptions[film.classification]) {
									classificationDetails = ratingDescriptions[film.classification];
								}
							}
							
							motsCles.forEach((motCle) => {
								if (film.content.includes(motCle) && ratingDescriptions[motCle]) {
									if (classificationDetails !== "") classificationDetails += "\n";
									classificationDetails += ratingDescriptions[motCle];
								}
							});

							const content = document.createElement("span");
							content.className = "content";
							content.textContent = cleanedContent;
							contentBlock.appendChild(content);

							const classification = document.createElement("div");
							const imageFilename = generateImageFilename(film);
							const image = document.createElement("img");
							image.src = `classification/${imageFilename}`;
							image.alt = "Classification visuelle";
							image.className = "classification-image";

							poster.appendChild(image);
							details.appendChild(contentBlock);
						}

						if (classificationDetails !== "") {
							const classificationDetailsDiv = document.createElement("div");
							classificationDetailsDiv.className = "classification-details";
							classificationDetailsDiv.textContent = classificationDetails;
							details.appendChild(classificationDetailsDiv);
						}
						
						if (film.synopsis) {
							const synopsis = document.createElement("div");
							synopsis.className = "synopsis";
							synopsis.textContent = film.synopsis;
							details.appendChild(synopsis);
						}

						card.appendChild(details);
						container.appendChild(card);

						const seancesDiv = document.createElement("div");
						seancesDiv.className = "seances";

						// Grouper les séances par date en filtrant directement
						const tz = "America/Toronto";

						// Date du jour à Toronto au format YYYY-MM-DD
						const aujourdHuiStr = new Date().toLocaleDateString("fr-CA", { timeZone: tz });

						// Heure actuelle à Toronto (heures et minutes séparées)
						const maintenant = new Date();

						const currentHour = parseInt(
  							new Intl.DateTimeFormat("fr-CA", {
    							timeZone: tz,
    							hour: "2-digit",
    							hour12: false
  							}).format(maintenant),
  							10
						);

						const currentMinute = parseInt(
  							new Intl.DateTimeFormat("fr-CA", {
    							timeZone: tz,
    							minute: "2-digit"
  							}).format(maintenant),
  							10
						);

						// console.log(`Heure actuelle à Toronto: ${currentHour}:${currentMinute}`);

						const seancesParDate = {};

						film.horaire
  							.sort((a, b) => (a.horaire < b.horaire ? -1 : 1))
  							.forEach((seance) => {
    							// Découper sur tout type d’espace (y compris insécable)
    							const parts = seance.horaire.trim().split(/\s+/);
    							const dateStr = parts[0]; // YYYY-MM-DD
    							const heurePure = parts[1].replace(/\u00A0/g, "").trim().substring(0, 5); // HH:MM pur
    							const attributs = parts
      								.slice(2)
      								.filter((item) => item.length > 0)
      								.sort((a, b) => (a < b ? -1 : 1));

    							// Debug pour vérifier
    							// console.log(`Séance: ${dateStr} ${heurePure} | Aujourd'hui: ${aujourdHuiStr} | Now Toronto: ${currentHour}:${currentMinute}`);

    							// 1️⃣ Ignorer les jours passés
    							if (dateStr < aujourdHuiStr) return;

    							// 2️⃣ Si aujourd'hui, ignorer les horaires déjà passés
    							if (dateStr === aujourdHuiStr) {
      								const [h, m] = heurePure.split(":").map((n) => parseInt(n, 10));

      								if (h < currentHour || (h === currentHour && m <= currentMinute)) {
        								// console.log(`⏩ Ignoré: ${heurePure} (passé)`);
        								return; // séance passée
      								}
    							}
    							// 3️⃣ Ajouter la séance filtrée
    							if (!seancesParDate[dateStr]) {
      								seancesParDate[dateStr] = [];
    							}
    							seancesParDate[dateStr].push({ heure: heurePure, attributs });
  						});

						// --- Affichage ---
						Object.entries(seancesParDate).forEach(([dateStr, seances]) => {
  							const dateObj = new Date(dateStr + "T00:00:00");
  							const jour = dateObj.toLocaleDateString("fr-CA", { weekday: "long" });
  							const jourNum = dateObj.toLocaleDateString("fr-CA", { day: "numeric" });
  							const mois = dateObj.toLocaleDateString("fr-CA", { month: "long" });

  							const jourLabel = document.createElement("div");
  							jourLabel.className = "jour-label";
  							if (dateStr === aujourdHuiStr) {
    							jourLabel.classList.add("aujourd-hui");
  							}
  							jourLabel.textContent = `${jour.toLowerCase()} ${jourNum}, ${mois.toLowerCase()}`;

  							const horairesDiv = document.createElement("div");
  							horairesDiv.className = "horaires";

  							seances.forEach(({ heure, attributs }) => {
    							const seanceLabel = document.createElement("div");

    							const horaireLabel = document.createElement("span");
    							horaireLabel.className = "seance-label";
   								horaireLabel.textContent = heure;
    							seanceLabel.appendChild(horaireLabel);

    						if (attributs.length > 0) {
      							const attributsLabel = document.createElement("span");
      							attributsLabel.className = "attributs-label";
      							attributsLabel.textContent = attributs.join(" ").trim();
      							seanceLabel.appendChild(attributsLabel);
    						}

    						horairesDiv.appendChild(seanceLabel);
  						});

  						const jourBlock = document.createElement("div");
  						jourBlock.className = "jour-block";
  						jourBlock.appendChild(jourLabel);
  						jourBlock.appendChild(horairesDiv);

  						seancesDiv.appendChild(jourBlock);
					});

						details.appendChild(seancesDiv);

						card.appendChild(details);
						container.appendChild(card);
					});
				})
				.catch((error) => {
					console.error("Erreur lors du chargement du fichier films.json :", error);
				});
document.getElementById("closeModal").addEventListener("click", () => {
    document.getElementById("videoModal").style.display = "none";
    document.getElementById("trailerFrame").src = ""; // stop vidéo
});

document.getElementById("videoModal").addEventListener("click", (e) => {
    if (e.target.id === "videoModal") {
        document.getElementById("videoModal").style.display = "none";
        document.getElementById("trailerFrame").src = "";
    }
});
</script></body>
</html>






































